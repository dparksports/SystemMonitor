<UserControl x:Class="DeviceMonitorCS.Controls.StatusShieldControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    <UserControl.Resources>
         <FontFamily x:Key="IconFont">Segoe MDL2 Assets</FontFamily>
    </UserControl.Resources>
    
    <Grid>
        <!-- Resources for Rotating Animation -->
        <Grid.Resources>
            <Storyboard x:Key="RotateInternalRing">
                <DoubleAnimation Storyboard.TargetName="InternalRingTransform" Storyboard.TargetProperty="Angle" From="0" To="360" Duration="0:0:10" RepeatBehavior="Forever"/>
            </Storyboard>
            <Storyboard x:Key="RotateExternalRing">
                <DoubleAnimation Storyboard.TargetName="ExternalRingTransform" Storyboard.TargetProperty="Angle" From="360" To="0" Duration="0:0:15" RepeatBehavior="Forever"/>
            </Storyboard>
        </Grid.Resources>
        
        <Grid.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard Storyboard="{StaticResource RotateInternalRing}"/>
                <BeginStoryboard Storyboard="{StaticResource RotateExternalRing}"/>
            </EventTrigger>
        </Grid.Triggers>

        <!-- Outer Rotating Dashed Ring -->
        <Ellipse Width="240" Height="240" Stroke="{Binding StatusColor}" StrokeThickness="2" StrokeDashArray="4 4" Opacity="0.3" RenderTransformOrigin="0.5,0.5">
            <Ellipse.RenderTransform>
                 <RotateTransform x:Name="ExternalRingTransform"/>
            </Ellipse.RenderTransform>
        </Ellipse>

        <!-- Inner Rotating Segmented Ring -->
        <Ellipse Width="210" Height="210" Stroke="{Binding StatusColor}" StrokeThickness="4" StrokeDashArray="20 10" Opacity="0.5" RenderTransformOrigin="0.5,0.5">
             <Ellipse.RenderTransform>
                 <RotateTransform x:Name="InternalRingTransform"/>
            </Ellipse.RenderTransform>
        </Ellipse>

        <!-- Pulsing Background Glow -->
        <Ellipse Width="180" Height="180" Fill="{Binding StatusColor}" Opacity="0.1">
            <Ellipse.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                             <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0.1" To="0.3" Duration="0:0:2"/>
                             <DoubleAnimation Storyboard.TargetProperty="Width" From="180" To="190" Duration="0:0:2"/>
                             <DoubleAnimation Storyboard.TargetProperty="Height" From="180" To="190" Duration="0:0:2"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Ellipse.Triggers>
        </Ellipse>

        <!-- Main Shield Circle (Glass Effect) -->
        <Border Width="160" Height="160" CornerRadius="80" BorderBrush="#33FFFFFF" BorderThickness="1">
            <Border.Background>
                <RadialGradientBrush Center="0.5,0" GradientOrigin="0.5,0" RadiusX="0.8" RadiusY="0.8">
                    <GradientStop Color="#40FFFFFF" Offset="0"/>
                    <GradientStop Color="#10FFFFFF" Offset="1"/>
                </RadialGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="{Binding StatusColor}" BlurRadius="30" ShadowDepth="0" Opacity="0.8"/>
            </Border.Effect>
            
            <!-- Inner Content (Icon) -->
            <Grid>
                 <TextBlock x:Name="ShieldIcon" Text="&#xE73E;" FontFamily="{StaticResource IconFont}" FontSize="64" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" Effect="{x:Null}">
                    <TextBlock.BitmapEffect>
                        <BlurBitmapEffect Radius="0"/> <!-- Clear text -->
                    </TextBlock.BitmapEffect>
                 </TextBlock>
            </Grid>
        </Border>
        
        <!-- Status Text Label Below Icon -->
        <TextBlock Text="{Binding StatusMessage}" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,120,0,0" HorizontalAlignment="Center" VerticalAlignment="Center">
             <TextBlock.Effect>
                 <DropShadowEffect Color="Black" BlurRadius="2" ShadowDepth="1"/>
             </TextBlock.Effect>
        </TextBlock>
    </Grid>
</UserControl>
